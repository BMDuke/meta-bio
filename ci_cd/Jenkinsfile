node {

    checkout scm

    stage 'Build'
    def metadata_api_image = docker.build("metadata_api", "./api")


    stage 'Test'

    metadata_api_image.withRun('-v ${JENKINS_HOME}/results:./results -p 8081:80') { c ->

        sh 'pytest -v --junitxml=results/results.xml'

    }    
    
    sh 'cat results/results.xml'

    stage 'Deploy'

    

}
